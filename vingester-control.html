<!DOCTYPE html>
<!--
**  Vingester ~ Ingest Web Contents as Video Streams
**  Copyright (c) 2021 Dr. Ralf S. Engelschall <rse@engelschall.com>
**  Licensed under GPL 3.0 <https://spdx.org/licenses/GPL-3.0-only>
-->
<html>
    <head>
        <!-- application title -->
        <title>Vingester</title>

        <!-- general meta-information -->
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
        <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' blob:; worker-src 'self' 'unsafe-inline' 'unsafe-eval' blob:;"/>

        <!-- load dependency: FontAwesome -->
        <link rel="stylesheet" type="text/css" href="node_modules/@fortawesome/fontawesome-free/css/all.min.css">
        <script type="text/javascript" src="node_modules/@fortawesome/fontawesome-free/js/all.min.js"></script>

        <!-- load dependency: TypoPRO -->
        <link rel="stylesheet" type="text/css" href="node_modules/typopro-web/web/TypoPRO-SourceSansPro/TypoPRO-SourceSansPro.css">
        <link rel="stylesheet" type="text/css" href="node_modules/typopro-web/web/TypoPRO-SourceCodePro/TypoPRO-SourceCodePro.css">
        <link rel="stylesheet" type="text/css" href="node_modules/typopro-web/web/TypoPRO-Overlock/TypoPRO-Overlock.css">

        <!-- load dependency: VueJS -->
        <script type="text/javascript" src="node_modules/sprintfjs/sprintf.js"></script>
        <script type="text/javascript" src="node_modules/vue/dist/vue.global.prod.js"></script>
        <link rel="stylesheet/less" type="text/css" href="node_modules/vue3-perfect-scrollbar/dist/vue3-perfect-scrollbar.css"/>
        <link rel="stylesheet/less" type="text/css" href="node_modules/tippy.js/dist/tippy.css"/>
        <link rel="stylesheet/less" type="text/css" href="node_modules/tippy.js/themes/translucent.css"/>

        <!-- load application style -->
        <link rel="stylesheet/less" type="text/css" href="vingester-control.css"/>

        <!-- load dependency: Less -->
        <script type="text/javascript" src="node_modules/less/dist/less.min.js"></script>
    </head>
    <body>
        <div class="ui">
            <div class="ui-head">
                <div class="row row-1">
                    <div class="row-left">
                        <img class="title-icon" src="vingester-icon.png" alt="Vingester"/>
                        <div
                            v-tippy="{ placement: 'bottom', content: 'Click to ' + (info ? 'close' : 'open') + ' program information.' }"
                            v-on:click="info = !info" class="title-text">
                            Vingester
                        </div>
                        <div class="title-subtext">&mdash; INGEST WEB CONTENTS AS VIDEO STREAMS</div>
                    </div>
                    <div class="row-middle">
                    </div>
                    <div class="row-right">
                        <div class="icons">
                            <div v-tippy="{ placement: 'bottom', content: 'Minimize window.' }"
                                class="icon" v-on:click="windowControl('minimize')">
                                <i class="fas fa-window-minimize"></i>
                            </div>
                            <div v-tippy="{ placement: 'bottom', content: 'Maximize window.' }"
                                class="icon" v-on:click="windowControl('maximize')">
                                <i class="fas fa-window-maximize"></i>
                            </div>
                            <div v-tippy="{ placement: 'bottom', content: 'Resize to smallest<br/>possible window size.' }"
                                class="icon" v-on:click="windowControl('standard')">
                                <i class="fas fa-caret-square-down"></i>
                            </div>
                            <div v-tippy="{ placement: 'bottom', content: 'Switch to fullscreen mode.' }"
                                class="icon" v-on:click="windowControl('fullscreen')">
                                <i class="fas fa-caret-square-up"></i>
                            </div>
                            <div v-tippy="{ placement: 'bottom', content: 'Quit application.' }"
                                class="icon" v-on:click="windowControl('close')">
                                <i class="fas fa-window-close"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="" v-show="info">
                    <div class="box">
                        <div class="row row-2">
                            <div class="row-left">
                                <div class="button-info">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="about">
                                    <b>Vingester</b> (<b>V</b>ideo <b>ingester</b>) is a small
                                    Electron-based desktop application for
                                    use under Windows, macOS or Linux to
                                    run multiple Chromium-based Web browser
                                    instances and ingesting their rendered
                                    Web Contents as screen/window-captured or
                                    NDI-multicasted video streams for further
                                    use in video mixing applications.
                                </div>
                            </div>
                            <div class="row-right">
                                <table class="versions">
                                    <tr><td>Vingester</td><td><b>{{version.vingester}}</b></td><td>&copy; Dr. Ralf S. Engelschall</td></tr>
                                    <tr><td>Electron</td> <td><b>{{version.electron}}</b></td> <td>&copy; Github, Inc.</td></tr>
                                    <tr><td>Chromium</td> <td><b>{{version.chromium}}</b></td> <td>&copy; Google LLC</td></tr>
                                    <tr><td>V8</td>       <td><b>{{version.v8}}</b></td>       <td>&copy; Google LLC</td></tr>
                                    <tr><td>Node</td>     <td><b>{{version.node}}</b></td>     <td>&copy; Ryan Dahl et al.</td></tr>
                                    <tr><td>NDI</td>      <td><b>{{version.ndi}}</b></td>      <td>&copy; NewTek, Inc.</td></tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="">
                    <div class="box">
                        <div class="row row-3">
                            <div class="row-left">
                                <div class="button-plus">
                                    <div v-tippy="{ placement: 'bottom', content: 'Create new browser<br/>configuration entry.' }"
                                        v-on:click="addBrowser">
                                        <i class="fas fa-plus-circle"></i>
                                    </div>
                                </div>
                                <div class="field field-start"
                                    v-tippy="{ placement: 'bottom', content: 'Start all (still) not<br/>running browsers.' }"
                                    v-bind:class="{ disabled: nAvailable === 0 || nAvailable === nRunning }"
                                    v-on:click="control('start-all', null)">
                                    <i class="fas fa-play"></i> &nbsp;START
                                </div>
                                <div class="field field-reload"
                                    v-tippy="{ placement: 'bottom', content: 'Reload all<br/>running browsers.' }"
                                    v-bind:class="{ disabled: nRunning === 0 }"
                                    v-on:click="control('reload-all', null)">
                                    <i class="fas fa-redo"></i> &nbsp;RELOAD
                                </div>
                                <div class="field field-stop"
                                    v-tippy="{ placement: 'bottom', content: 'Stop all (still)<br/>running browsers.' }"
                                    v-bind:class="{ disabled: nRunning === 0 }"
                                    v-on:click="control('stop-all', null)">
                                    <i class="fas fa-pause"></i> &nbsp;STOP
                                </div>
                            </div>
                            <div class="row-middle">
                                <div class="field field-usage"
                                    v-tippy="{ placement: 'bottom', content: 'Shows the current<br>overall CPU usage.' }">
                                    <i class="fas fa-microchip"></i> &nbsp;CPU: {{ usage.toFixed(1) }}%
                                </div>
                                <div class="field field-gpu" v-on:click="toggleGPU"
                                    v-tippy="{ placement: 'bottom', content: (gpu ? 'Disable the currently enabled' : 'Enable the currently disabled') + '<br/>GPU hardware acceleration.<br/>Enable for Frameless mode.<br/>Disable for Headless mode.' }">
                                    <span v-show="gpu"><i class="fas fa-check-circle"></i>&nbsp;&nbsp;GPU: YES</span>
                                    <span v-show="!gpu"><i class="fas fa-times-circle"></i>&nbsp;&nbsp;GPU: NO</span>
                                </div>
                            </div>
                            <div class="row-right">
                                <div v-tippy="{ placement: 'bottom', content: 'Export browser configurations<br/>to external YAML file.' }"
                                    class="field field-export" v-on:click="exportBrowsers">
                                    <i class="fas fa-upload"></i> &nbsp;EXPORT
                                </div>
                                <div v-tippy="{ placement: 'bottom', content: 'Import browser configurations<br/>from external YAML file.' }"
                                    class="field field-import" v-on:click="importBrowsers">
                                    <i class="fas fa-download"></i> &nbsp;IMPORT
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ui-body">
                <perfect-scrollbar>
                    <div v-for="browser in browsers" v-bind:key="browser.id" class="browser" v-bind:class="{ running: running[browser.id] }">
                        <div class="button button-minus">
                            <div v-tippy="{ placement: 'bottom', content: 'Delete this browser<br/>configuration entry.' }"
                                v-on:click="delBrowser(browser)">
                                <i class="fas fa-minus-circle"></i>
                            </div>
                        </div>
                        <div class="box">
                            <div class="preview" v-show="browser.P === true && running[browser.id]"
                                v-tippy="{ placement: 'bottom', content: 'Shows a thumbnail preview (128x72px)<br/>of the Web Content rendering.' }">
                                <canvas v-bind:ref="'canvas-' + browser.id" width="128" height="72"></canvas>
                            </div>
                            <div class="row">
                                <div class="group">BROWSER:</div>
                                <div class="label label-title">Title:</div>
                                <div class="field field-title"
                                    v-tippy="{ placement: 'top', content: 'Title of browser window<br/>or name of NDI stream.' }">
                                    <input type="text" v-model="browser.t" v-on:keyup="changed(browser)"
                                        v-bind:class="{ disabled: running[browser.id] }"
                                        v-bind:disabled="running[browser.id]">
                                </div>
                                <div class="label label-size">Size:</div>
                                <div class="field"
                                    v-tippy="{ placement: 'top', content: 'Width of browser canvas in pixels.<br/>Use 854 for 480p, 1280 for 720p or 1920 for 1080p.' }">
                                    <input type="text" v-model="browser.w" v-on:keyup="changed(browser)"
                                        v-bind:class="{ disabled: running[browser.id] }"
                                        v-bind:disabled="running[browser.id]">
                                </div>
                                <div class="sep">x</div>
                                <div class="field"
                                    v-tippy="{ placement: 'top', content: 'Height of browser canvas in pixels.<br/>Use 480 for 480p, 720 for 720p or 1080 for 1080p.' }">
                                    <input type="text" v-model="browser.h" v-on:keyup="changed(browser)"
                                        v-bind:class="{ disabled: running[browser.id] }"
                                        v-bind:disabled="running[browser.id]">
                                </div>
                                <div class="label">Color:</div>
                                <div class="field field-color"
                                    v-tippy="{ placement: 'top', content: 'RGB hexadecimal background<br/>color of browser canvas.' }">
                                    <input type="text" v-model="browser.c" v-on:keyup="changed(browser)"
                                        v-bind:class="{ disabled: running[browser.id] }"
                                        v-bind:disabled="running[browser.id]">
                                </div>
                            </div>
                            <div class="row">
                                <div class="group">INPUT:</div>
                                <div class="label label-url">URL:</div>
                                <div class="field field-url"
                                    v-tippy="{ placement: 'top', content: 'Uniform Resource Locator (URL)<br/>of Web Content to render.' }">
                                    <input type="text" v-model="browser.u" v-on:keyup="changed(browser)"
                                        v-bind:class="{ disabled: running[browser.id] }"
                                        v-bind:disabled="running[browser.id]">
                                </div>
                            </div>
                            <div class="row">
                                <div class="group">OUTPUT 1:</div>
                                <div class="label label-output">Frameless (WIN):</div>
                                <div class="field"
                                    v-tippy="{ placement: 'top', content: 'Click to ' + (browser.D ? 'disable' : 'enable') + ' Frameless mode, i.e.,<br/>Web Content is rendered into a desktop window.' }">
                                    <div class="toggle" v-on:click="toggle(browser, 'D', [ true, false ])">
                                        <div class="toggle-option" v-bind:class="{ selected: browser.D === true  }"><i class="fas fa-check-circle"></i>&nbsp;&nbsp;YES</div>
                                        <div class="toggle-option" v-bind:class="{ selected: browser.D === false }"><i class="fas fa-times-circle"></i>&nbsp;&nbsp;NO</div>
                                    </div>
                                </div>
                                <div class="cluster" v-show="browser.D">
                                    <div class="label label-pos">Pos:</div>
                                    <div class="field"
                                        v-tippy="{ placement: 'top', content: 'X-Position of desktop window (0 is at left border)<br/>(absolute or relative to display).' }">
                                        <input type="text" v-model="browser.x" v-on:keyup="changed(browser)"
                                            v-bind:class="{ disabled: running[browser.id] }"
                                            v-bind:disabled="running[browser.id]">
                                    </div>
                                    <div class="sep">x</div>
                                    <div class="field"
                                        v-tippy="{ placement: 'top', content: 'Y-Position of desktop window (0 is at top border)<br/>(absolute or relative to display).' }">
                                        <input type="text" v-model="browser.y" v-on:keyup="changed(browser)"
                                            v-bind:class="{ disabled: running[browser.id] }"
                                            v-bind:disabled="running[browser.id]">
                                    </div>
                                    <div class="sep">@</div>
                                    <div class="field"
                                        v-tippy="{ placement: 'top', content: 'X/Y-Selection of display for relative positioning<br/>0,0 is primary display, -1,0 the display on the left side,<br/>0,-1 the display at the top, etc.' }">
                                        <input type="text" v-model="browser.d" v-on:keyup="changed(browser)"
                                            v-bind:class="{ disabled: running[browser.id] }"
                                            v-bind:disabled="running[browser.id]">
                                    </div>
                                    <div class="label">Pin:</div>
                                    <div class="field"
                                        v-tippy="{ placement: 'top', content: 'Click to ' + (browser.p ? 'disable' : 'enable') + ' pinning the desktop window to the top,<br/>i.e., above all other windows on the desktop.' }">
                                        <div class="toggle" v-on:click="toggle(browser, 'p', [ true, false ])">
                                            <div class="toggle-option toggle-option-pin"   v-bind:class="{ selected: browser.p === true  }"><i class="fas fa-check-circle"></i>&nbsp;&nbsp;YES</div>
                                            <div class="toggle-option toggle-option-nopin" v-bind:class="{ selected: browser.p === false }"><i class="fas fa-times-circle"></i>&nbsp;&nbsp;NO</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="group">OUTPUT 2:</div>
                                <div class="label label-output">Headless (NDI):</div>
                                <div class="field"
                                    v-tippy="{ placement: 'top', content: 'Click to ' + (browser.N ? 'disable' : 'enable') + ' Headless mode, i.e.,<br/>Web Content is multicasted via NDI.' }">
                                    <div class="toggle" v-on:click="toggle(browser, 'N', [ true, false ])">
                                        <div class="toggle-option" v-bind:class="{ selected: browser.N === true  }"><i class="fas fa-check-circle"></i>&nbsp;&nbsp;YES</div>
                                        <div class="toggle-option" v-bind:class="{ selected: browser.N === false }"><i class="fas fa-times-circle"></i>&nbsp;&nbsp;NO</div>
                                    </div>
                                </div>
                                <div class="cluster" v-show="browser.N">
                                    <div class="label">FPS:</div>
                                    <div class="field"
                                        v-tippy="{ placement: 'top', content: 'Frames per second for the NDI video-stream.<br/>Usually you want to use 30 or 60.' }">
                                        <input type="text" v-model="browser.f" v-on:keyup="changed(browser)"
                                            v-bind:class="{ disabled: running[browser.id] }"
                                            v-bind:disabled="running[browser.id]">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="row-left">
                                    <div class="field field-start"
                                        v-tippy="{ placement: 'top', content: 'Start browser.' }"
                                        v-bind:class="{ disabled: (!browser.D && !browser.N) || browser.u === '' }"
                                        v-on:click="control('start', browser.id)">
                                        <i class="fas fa-play"></i> &nbsp;START
                                    </div>
                                    <div class="field field-reload"
                                        v-tippy="{ placement: 'top', content: 'Reload browser.' }"
                                        v-on:click="control('reload', browser.id)">
                                        <i class="fas fa-redo"></i> &nbsp;RELOAD
                                    </div>
                                    <div class="field field-stop"
                                        v-tippy="{ placement: 'top', content: 'Stop browser.' }"
                                        v-on:click="control('stop', browser.id)">
                                        <i class="fas fa-pause"></i> &nbsp;STOP
                                    </div>
                                    <div
                                        v-tippy="{ placement: 'top', content: 'Click to ' + (browser.P ? 'disable' : 'enable') + ' the Web Content<br/>preview mode on the right side.' }"
                                        class="field field-preview" v-on:click="toggle(browser, 'P', [ true, false ])">
                                        <span v-show="browser.P === true"><i class="fas fa-eye"></i></span>
                                        <span v-show="browser.P === false"><i class="fas fa-eye-slash"></i></span>
                                        &nbsp;PREVIEW
                                    </div>
                                </div>
                                <div class="row-middle">
                                </div>
                                <div class="row-right">
                                    <div class="stat" v-if="running[browser.id]">
                                        <span
                                            v-tippy="{ placement: 'top', content: 'Shows the CPU performance (milliseconds per frame)<br/>of the browser Web Content rendering.' }"
                                            class="stat-item" v-if="browser.N || browser.P">
                                        CPU: {{ Math.round(burst[browser.id].avg) }}/{{ stat[browser.id].fps > 0 ? Math.round(1000 / stat[browser.id].fps) : "-" }} ms/f
                                        </span>
                                        <span
                                            v-tippy="{ placement: 'top', content: 'Shows the graphics performance (frames per second)<br/>of the browser Web Content rendering.' }"
                                            class="stat-item">
                                        GFX: {{ Math.round(stat[browser.id].fps) }} f/s
                                        </span>
                                        <span
                                            v-tippy="{ placement: 'top', content: 'Shows the memory consumption (megabytes)<br/>of the Web Content rendering.' }"
                                            class="stat-item">
                                        RAM: {{ stat[browser.id].memUsed.toFixed(1) }}/{{ stat[browser.id].memAvail.toFixed(0) }} MB
                                        </span>
                                        <span
                                            v-tippy="{ placement: 'top', content: 'Click to ' + (trace[browser.id].visible ? 'close' : 'open') + ' Web Content<br/>console output.' }"
                                            class="stat-item stat-item-trace" v-on:click="trace[browser.id].visible = !trace[browser.id].visible">
                                        CON: {{ trace[browser.id].warning }} W, {{ trace[browser.id].error }} E
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="row" v-show="running[browser.id] && trace[browser.id].visible">
                                <div class="console" v-bind:ref="'console-' + browser.id">
                                    <div class="console-line" v-for="(message, i) in trace[browser.id].messages" v-bind:key="i">
                                        <div class="console-level">{{ message.level }}:</div>
                                        <div class="console-message">{{ message.message }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </perfect-scrollbar>
            </div>
        </div>
    </body>
    <script type="text/javascript" src="vingester-control.js"></script>
</html>
